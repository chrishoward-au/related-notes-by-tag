/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, please visit the github repository of this plugin
*/

var R=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var W=(r,a)=>{for(var e in a)R(r,e,{get:a[e],enumerable:!0})},U=(r,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of I(a))!G.call(r,s)&&s!==e&&R(r,s,{get:()=>a[s],enumerable:!(t=A(a,s))||t.enumerable});return r};var _=r=>U(R({},"__esModule",{value:!0}),r);var $={};W($,{default:()=>S});module.exports=_($);var x=require("obsidian");var m=require("obsidian"),V={customSidebarTitle:"Related Notes",defaultSortMode:"name",defaultFilterMode:1,excludedTags:"",defaultGroupState:"collapsed"},M=class extends m.PluginSettingTab{constructor(a,e){super(a,e),this.plugin=e}display(){let{containerEl:a}=this;a.empty(),a.createEl("h2",{text:"Related notes by tag"}),new m.Setting(a).setName("Custom sidebar title").setDesc("Title displayed at the top of the Related Notes sidebar").addText(t=>t.setPlaceholder("Enter custom title").setValue(this.plugin.settings.customSidebarTitle).onChange(async s=>{this.plugin.settings.customSidebarTitle=s,await this.plugin.saveSettings()})),new m.Setting(a).setName("Default sort mode").setDesc("How to sort related notes by default").addDropdown(t=>t.addOption("name","Name").addOption("date","Date Edited").addOption("created","Date Created").setValue(this.plugin.settings.defaultSortMode).onChange(async s=>{this.plugin.settings.defaultSortMode=s,await this.plugin.saveSettings()})),new m.Setting(a).setName("Excluded tags").setDesc("Comma-separated list of tags to exclude from related notes").addText(t=>t.setPlaceholder("e.g., #ignore, #draft").setValue(this.plugin.settings.excludedTags).onChange(async s=>{this.plugin.settings.excludedTags=s,await this.plugin.saveSettings()})),new m.Setting(a).setName("Default group state").setDesc("Initial expansion state of tag groups").addDropdown(t=>t.addOption("collapsed","Collapsed").addOption("expanded","Expanded").setValue(this.plugin.settings.defaultGroupState).onChange(async s=>{this.plugin.settings.defaultGroupState=s,await this.plugin.saveSettings()})),a.createEl("h3",{text:"Activation and Usage Instructions"});let e=a.createDiv("related-notes-instructions");e.createEl("p",{text:"To activate the Related Notes sidebar:"}),e.createEl("ul",{},t=>{t.createEl("li",{text:"Click the ribbon icon (tag icon)"}),t.createEl("li",{text:'Or use the command palette: "Open Related Notes Panel"'})}),e.createEl("p",{text:"Usage:"}),e.createEl("ul",{},t=>{t.createEl("li",{text:"Click tag group header to expand/collapse group"}),t.createEl("li",{text:"Click note name to open in current tab"}),t.createEl("li",{text:"cmd/ctrl click note name to open in new tab"}),t.createEl("li",{text:"Click Name/Date to change sort order"})})}};var c=require("obsidian"),y="related-notes-view",C=class extends c.ItemView{constructor(e,t){super(e);this.selectedTagCount=1;this.trackMousePosition=e=>{this.lastMousePosition={x:e.clientX,y:e.clientY}};this.isModifierHeld=!1;this.previewPopup=null;this.currentPreviewFile=null;this.lastMousePosition={x:0,y:0};this.handleKeyDown=e=>{if(this.isModifierHeld=e.metaKey||e.ctrlKey,this.isModifierHeld){let t=document.elementFromPoint(this.lastMousePosition.x,this.lastMousePosition.y),s=t==null?void 0:t.closest(".related-note-link");if(s instanceof HTMLElement&&s.dataset.filePath){let l=this.app.vault.getAbstractFileByPath(s.dataset.filePath);l instanceof c.TFile&&this.showPreview(l,s)}}};this.handleKeyUp=e=>{this.isModifierHeld=e.metaKey||e.ctrlKey,!this.isModifierHeld&&this.previewPopup&&this.hidePreview()};this.hidePreviewOnClick=()=>{this.hidePreview()};this.plugin=t,document.addEventListener("mousemove",this.trackMousePosition),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}async handleSortChange(e){this.plugin.settings.defaultSortMode=e,await this.plugin.saveSettings(),this.updateView()}async handleFilterChange(e){this.plugin.settings.defaultFilterMode=e,await this.plugin.saveSettings(),this.updateView()}getViewType(){return y}getDisplayText(){return"Related Notes"}getIcon(){return"tag"}async onOpen(){this.container=this.contentEl,this.container.empty(),this.container.addClass("related-notes-container"),this.container.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes"}),this.updateView()}async onClose(){document.removeEventListener("mousemove",this.trackMousePosition),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.hidePreview(),this.container.empty()}showPreview(e,t){this.hidePreview(),this.previewPopup=document.body.createDiv("related-notes-preview"),this.currentPreviewFile=e;let s=t.getBoundingClientRect(),l=400,p=10,g=window.innerWidth,k;s.right+l+p<=g?k=s.right+p:s.left-l-p>=0?k=s.left-l-p:k=Math.max(p,Math.min((g-l)/2,g-l-p));let L=s.top,b=window.innerHeight;this.previewPopup.style.position="fixed",this.previewPopup.style.left=`${k}px`,this.previewPopup.style.top=`${L}px`,this.previewPopup.style.zIndex="9999",this.previewPopup.style.width=`${l}px`,this.previewPopup.style.maxHeight="40hv",this.previewPopup.style.overflowY="auto",document.addEventListener("click",this.hidePreviewOnClick,{once:!0}),setTimeout(()=>{this.previewPopup&&this.currentPreviewFile===e&&this.isModifierHeld&&c.MarkdownRenderer.render(this.app,`![[${e.basename}]]`,this.previewPopup,e.path,this).then(()=>{var v;(v=this.previewPopup)==null||v.addClass("is-loaded"),!t.matches(":hover")||this.isModifierHeld})},150)}hidePreview(){this.previewPopup&&(this.previewPopup.remove(),this.previewPopup=null,this.currentPreviewFile=null)}async updateView(){if(!this.plugin.app.workspace.layoutReady)return;this.container.empty(),this.container.addClass("related-notes-container");let e=this.container.createDiv("related-notes-header");e.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes",cls:"related-notes-title"});let t=e.createDiv("action-buttons"),l=t.createDiv("sort-controls").createDiv("dropdown-container"),p=l.createEl("button",{cls:"dropdown-trigger"});p.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M3 6h18M6 12h12M10 18h4"/></svg>';let g=l.createDiv("dropdown-menu");["name","date","created"].forEach(i=>{let d=g.createEl("div",{cls:`dropdown-item ${this.plugin.settings.defaultSortMode===i?"is-active":""}`,text:i==="date"?"Modified Date":i==="created"?"Created Date":"Name"});d.addEventListener("click",()=>{this.handleSortChange(i),g.classList.remove("is-visible"),g.querySelectorAll(".dropdown-item").forEach(o=>o.classList.remove("is-active")),d.classList.add("is-active")})}),p.addEventListener("click",i=>{i.stopPropagation(),g.classList.toggle("is-visible")});let L=t.createDiv("filter-controls").createDiv("dropdown-container"),b=L.createEl("button",{cls:"dropdown-trigger"});b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/></svg>';let v=L.createDiv("dropdown-menu");[1,2,3].forEach(i=>{let d=v.createEl("div",{cls:`dropdown-item ${this.plugin.settings.defaultFilterMode===i?"is-active":""}`,text:i===2?"Match at least 2 tags":i===3?"Match at least 3 tags":"Match at least 1 tags"});d.addEventListener("click",()=>{this.handleFilterChange(i),v.classList.remove("is-visible"),v.querySelectorAll(".dropdown-item").forEach(o=>o.classList.remove("is-active")),d.classList.add("is-active")})}),b.addEventListener("click",i=>{i.stopPropagation(),v.classList.toggle("is-visible")});let T=this.app.workspace.getActiveFile();if(!T||!(T instanceof c.TFile)){this.container.createEl("p",{text:"No active note or not a markdown file."});return}else this.container.createEl("p",{text:T.basename,cls:"related-activefile-name"});let F=this.app.metadataCache.getFileCache(T);if(!F){this.container.createEl("p",{text:"Could not get file cache for the active note."});return}let N=(0,c.getAllTags)(F);if(!N||N.length===0){this.container.createEl("p",{text:"Active note has no tags."});return}let H=this.plugin.settings.excludedTags.split(",").map(i=>i.trim().toLowerCase()).filter(i=>i.length>0),K=[...new Set(N)].filter(i=>!H.includes(i.toLowerCase())),O=this.app.vault.getMarkdownFiles(),P=new Map;for(let i of O){if(i.path===T.path)continue;let d=this.app.metadataCache.getFileCache(i);if(d){let o=(0,c.getAllTags)(d);if(o){let D=[...new Set(o)],h=K.filter(f=>D.includes(f));h.length>0&&console.log("overlappingTags:",h),h.length>=this.selectedTagCount&&h.forEach(f=>{var n;P.has(f)||P.set(f,[]),(n=P.get(f))==null||n.push(i)})}}}if(P.size===0){this.container.createEl("p",{text:"No other notes found with matching tags."});return}P.forEach((i,d)=>{let o=this.container.createDiv({cls:`related-notes-tag-group ${this.plugin.settings.defaultGroupState}`}),D=o.createEl("div",{text:`Notes with tag: ${d}`,cls:"related-notes-tag-group-header"}),h=o.createEl("ul",{cls:"related-notes-list"});h.style.display=this.plugin.settings.defaultGroupState==="collapsed"?"none":"",D.addEventListener("click",()=>{o.toggleClass("collapsed",!o.hasClass("collapsed")),o.hasClass("collapsed")?h.style.display="none":h.style.display=""}),this.plugin.settings.defaultSortMode==="date"?i.sort((n,E)=>E.stat.mtime-n.stat.mtime):this.plugin.settings.defaultSortMode==="created"?i.sort((n,E)=>E.stat.ctime-n.stat.ctime):i.sort((n,E)=>n.basename.localeCompare(E.basename)),i.forEach(n=>{let w=h.createEl("li",{cls:"related-notes-list-item"}).createEl("a",{text:n.basename,href:"#",title:`Hold Cmd/Ctrl + hover to preview
Click to open`,cls:"related-note-link"});w.dataset.filePath=n.path,w.addEventListener("mouseenter",u=>{(u.metaKey||u.ctrlKey||this.isModifierHeld)&&this.showPreview(n,w)}),w.addEventListener("keydown",u=>{(u.metaKey||u.ctrlKey)&&w.matches(":hover")&&this.showPreview(n,w)}),w.addEventListener("click",u=>{u.preventDefault(),u.ctrlKey||u.metaKey?this.app.workspace.getLeaf("tab").openFile(n,{active:!0}):this.app.workspace.getLeaf().openFile(n,{active:!0})})});let f=o.createEl("hr",{cls:"related-notes-separator"})})}};var S=class extends x.Plugin{constructor(){super(...arguments);this.view=null}async onload(){console.log("Loading Related Notes by Tag plugin"),await this.loadSettings(),this.registerView(y,e=>(this.view=new C(e,this),this.view)),(0,x.addIcon)("related-notes-icon",'<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/><path d="M6 9.01V9"/><path d="m15 5 6.3 6.3a2.69 2.69 0 0 1 0 3.79L17.5 19a2.69 2.69 0 0 1-3.79 0L10 15.21"/></svg>'),this.addRibbonIcon("related-notes-icon","Open Related Notes Panel",()=>{this.activateView()}),this.addCommand({id:"open-related-notes-panel",name:"Open Related Notes Panel",callback:()=>{this.activateView()}}),this.addSettingTab(new M(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",e=>{this.view&&e&&this.view.leaf!==e&&e.view.getViewType()==="markdown"&&setTimeout(async()=>{this.view&&await this.view.updateView()},50)})),this.registerEvent(this.app.metadataCache.on("changed",async e=>{var t;this.view&&((t=this.app.workspace.getActiveFile())==null?void 0:t.path)===e.path&&await this.view.updateView()})),this.app.workspace.onLayoutReady(async()=>{let e=this.app.workspace.getActiveFile()}),console.log("Related Notes by Tag plugin loaded.")}onunload(){console.log("Unloading Related Notes by Tag plugin"),this.app.workspace.detachLeavesOfType(y),this.view=null}async loadSettings(){this.settings=Object.assign({},V,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.view&&await this.view.updateView()}async activateView(){let e=this.app.workspace.getLeavesOfType(y);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getRightLeaf(!1);t||(t=this.app.workspace.getRightLeaf(!0)),t?(await t.setViewState({type:y,active:!0}),this.app.workspace.revealLeaf(t)):new x.Notice("Could not open Related Notes panel: No available leaf.")}};

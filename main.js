/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, please visit the github repository of this plugin
*/

var N=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var F=(o,a)=>{for(var e in a)N(o,e,{get:a[e],enumerable:!0})},V=(o,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of R(a))!D.call(o,i)&&i!==e&&N(o,i,{get:()=>a[i],enumerable:!(t=M(a,i))||t.enumerable});return o};var H=o=>V(N({},"__esModule",{value:!0}),o);var K={};F(K,{default:()=>S});module.exports=H(K);var y=require("obsidian");var w=require("obsidian"),b={customSidebarTitle:"Related Notes",defaultSortMode:"name",excludedTags:"",defaultGroupState:"collapsed"},k=class extends w.PluginSettingTab{constructor(a,e){super(a,e),this.plugin=e}display(){let{containerEl:a}=this;a.empty(),new w.Setting(a).setName("Custom sidebar title").setDesc("Title displayed at the top of the Related Notes sidebar").addText(t=>t.setPlaceholder("Enter custom title").setValue(this.plugin.settings.customSidebarTitle).onChange(async i=>{this.plugin.settings.customSidebarTitle=i,await this.plugin.saveSettings()})),new w.Setting(a).setName("Default sort mode").setDesc("How to sort related notes by default").addDropdown(t=>t.addOption("name","Name").addOption("date","Date Edited").setValue(this.plugin.settings.defaultSortMode).onChange(async i=>{this.plugin.settings.defaultSortMode=i,await this.plugin.saveSettings()})),new w.Setting(a).setName("Excluded tags").setDesc("Comma-separated list of tags to exclude from related notes").addText(t=>t.setPlaceholder("e.g., #ignore, #draft").setValue(this.plugin.settings.excludedTags).onChange(async i=>{this.plugin.settings.excludedTags=i,await this.plugin.saveSettings()})),new w.Setting(a).setName("Default group state").setDesc("Initial expansion state of tag groups").addDropdown(t=>t.addOption("collapsed","Collapsed").addOption("expanded","Expanded").setValue(this.plugin.settings.defaultGroupState).onChange(async i=>{this.plugin.settings.defaultGroupState=i,await this.plugin.saveSettings()})),a.createEl("h3",{text:"Activation and Usage Instructions"});let e=a.createDiv("related-notes-instructions");e.createEl("p",{text:"To activate the Related Notes sidebar:"}),e.createEl("ul",{},t=>{t.createEl("li",{text:"Click the ribbon icon (tag icon)"}),t.createEl("li",{text:'Or use the command palette: "Open Related Notes Panel"'})}),e.createEl("p",{text:"Usage:"}),e.createEl("ul",{},t=>{t.createEl("li",{text:"Click tag group header to expand/collapse group"}),t.createEl("li",{text:"Click note name to open in current tab"}),t.createEl("li",{text:"cmd/ctrl click note name to open in new tab"}),t.createEl("li",{text:"Click Name/Date to change sort order"})})}};var d=require("obsidian"),v="related-notes-view",T=class extends d.ItemView{constructor(e,t){super(e);this.trackMousePosition=e=>{this.lastMousePosition={x:e.clientX,y:e.clientY}};this.isModifierHeld=!1;this.previewPopup=null;this.currentPreviewFile=null;this.lastMousePosition={x:0,y:0};this.handleKeyDown=e=>{if(this.isModifierHeld=e.metaKey||e.ctrlKey,this.isModifierHeld){let t=document.elementFromPoint(this.lastMousePosition.x,this.lastMousePosition.y),i=t==null?void 0:t.closest(".related-note-link");if(i instanceof HTMLElement&&i.dataset.filePath){let n=this.app.vault.getAbstractFileByPath(i.dataset.filePath);n instanceof d.TFile&&this.showPreview(n,i)}}};this.handleKeyUp=e=>{this.isModifierHeld=e.metaKey||e.ctrlKey,!this.isModifierHeld&&this.previewPopup&&this.hidePreview()};this.hidePreviewOnClick=()=>{this.hidePreview()};this.plugin=t,document.addEventListener("mousemove",this.trackMousePosition),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}async handleSortChange(e){this.plugin.settings.defaultSortMode=e,await this.plugin.saveSettings(),this.updateView()}getViewType(){return v}getDisplayText(){return"Related Notes"}getIcon(){return"tag"}async onOpen(){this.container=this.contentEl,this.container.empty(),this.container.addClass("related-notes-container"),this.container.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes"}),this.updateView()}async onClose(){document.removeEventListener("mousemove",this.trackMousePosition),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.hidePreview(),this.container.empty()}showPreview(e,t){this.hidePreview(),this.previewPopup=document.body.createDiv("related-notes-preview"),this.currentPreviewFile=e;let i=t.getBoundingClientRect(),n=300,l=10,f=window.innerWidth;console.log("Link position:",i),console.log("Viewport width:",f);let p;i.right+n+l<=f?(p=i.right+l,console.log("Positioning to right:",p)):i.left-n-l>=0?(p=i.left-n-l,console.log("Positioning to left:",p)):(p=Math.max(l,Math.min((f-n)/2,f-n-l)),console.log("Positioning centered:",p));let L=i.top,m=window.innerHeight;this.previewPopup.style.position="fixed",this.previewPopup.style.left=`${p}px`,this.previewPopup.style.top=`${L}px`,this.previewPopup.style.zIndex="9999",this.previewPopup.style.width=`${n}px`,this.previewPopup.style.maxHeight="70vh",this.previewPopup.style.overflowY="auto",document.addEventListener("click",this.hidePreviewOnClick,{once:!0}),setTimeout(()=>{this.previewPopup&&this.currentPreviewFile===e&&this.isModifierHeld&&d.MarkdownRenderer.render(this.app,`![[${e.basename}]]`,this.previewPopup,e.path,this).then(()=>{var E;(E=this.previewPopup)==null||E.addClass("is-loaded"),!t.matches(":hover")||this.isModifierHeld})},150)}hidePreview(){this.previewPopup&&(this.previewPopup.remove(),this.previewPopup=null,this.currentPreviewFile=null)}async updateView(){var E;if(!this.plugin.app.workspace.layoutReady)return;this.container.empty(),this.container.addClass("related-notes-container");let e=this.container.createDiv("related-notes-header");e.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes"});let t=e.createDiv("sort-controls");["name","date"].forEach(s=>{t.createEl("button",{text:s.charAt(0).toUpperCase()+s.slice(1),cls:`sort-button ${this.plugin.settings.defaultSortMode===s?"is-active":""}`}).addEventListener("click",()=>this.handleSortChange(s))});let i=this.app.workspace.getActiveFile();if(!i||!(i instanceof d.TFile)){this.container.createEl("p",{text:"No active note or not a markdown file."});return}else this.container.createEl("p",{text:i.basename,cls:"related-activefile-name"});let n=this.app.metadataCache.getFileCache(i);if(!n){this.container.createEl("p",{text:"Could not get file cache for the active note."});return}let l=(0,d.getAllTags)(n);if(!l||l.length===0){this.container.createEl("p",{text:"Active note has no tags."});return}let f=this.plugin.settings.excludedTags.split(",").map(s=>s.trim().toLowerCase()).filter(s=>s.length>0),p=[...new Set(l)].filter(s=>!f.includes(s.toLowerCase())),L=this.app.vault.getMarkdownFiles(),m=new Map;for(let s of L){if(s.path===i.path)continue;let P=this.app.metadataCache.getFileCache(s);if(P){let u=(0,d.getAllTags)(P);if(u){let C=[...new Set(u)];for(let c of p)C.includes(c)&&(m.has(c)||m.set(c,[]),(E=m.get(c))==null||E.push(s))}}}if(m.size===0){this.container.createEl("p",{text:"No other notes found with matching tags."});return}m.forEach((s,P)=>{let u=this.container.createDiv({cls:`related-notes-tag-group ${this.plugin.settings.defaultGroupState}`}),C=u.createEl("div",{text:`Notes with tag: ${P}`,cls:"related-notes-tag-group-header"}),c=u.createEl("ul",{cls:"related-notes-list"});c.style.display=this.plugin.settings.defaultGroupState==="collapsed"?"none":"",C.addEventListener("click",()=>{u.toggleClass("collapsed",!u.hasClass("collapsed")),u.hasClass("collapsed")?c.style.display="none":c.style.display=""}),this.plugin.settings.defaultSortMode==="date"?s.sort((r,x)=>x.stat.mtime-r.stat.mtime):s.sort((r,x)=>r.basename.localeCompare(x.basename)),s.forEach(r=>{let g=c.createEl("li",{cls:"related-notes-list-item"}).createEl("a",{text:r.basename,href:"#",title:`Hold Cmd/Ctrl + hover to preview
Click to open`,cls:"related-note-link"});g.dataset.filePath=r.path,g.addEventListener("mouseenter",h=>{(h.metaKey||h.ctrlKey||this.isModifierHeld)&&this.showPreview(r,g)}),g.addEventListener("keydown",h=>{(h.metaKey||h.ctrlKey)&&g.matches(":hover")&&this.showPreview(r,g)}),g.addEventListener("mouseleave",()=>{}),g.addEventListener("click",h=>{h.preventDefault(),h.ctrlKey||h.metaKey?this.app.workspace.getLeaf("tab").openFile(r,{active:!0}):this.app.workspace.getLeaf().openFile(r,{active:!0})})})})}};var S=class extends y.Plugin{constructor(){super(...arguments);this.view=null}async onload(){console.log("Loading Related Notes by Tag plugin"),await this.loadSettings(),this.registerView(v,e=>(this.view=new T(e,this),this.view)),(0,y.addIcon)("related-notes-icon",'<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/><path d="M6 9.01V9"/><path d="m15 5 6.3 6.3a2.69 2.69 0 0 1 0 3.79L17.5 19a2.69 2.69 0 0 1-3.79 0L10 15.21"/></svg>'),this.addRibbonIcon("related-notes-icon","Open Related Notes Panel",()=>{this.activateView()}),this.addCommand({id:"open-related-notes-panel",name:"Open Related Notes Panel",callback:()=>{this.activateView()}}),this.addSettingTab(new k(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",e=>{this.view&&e&&this.view.leaf!==e&&e.view.getViewType()==="markdown"&&setTimeout(async()=>{this.view&&await this.view.updateView()},50)})),this.registerEvent(this.app.metadataCache.on("changed",async e=>{var t;this.view&&((t=this.app.workspace.getActiveFile())==null?void 0:t.path)===e.path&&await this.view.updateView()})),this.app.workspace.onLayoutReady(async()=>{if(this.app.workspace.getActiveFile()){let t=this.app.workspace.getLeavesOfType(v)[0];t&&(this.app.workspace.revealLeaf(t),this.view&&await this.view.updateView())}}),console.log("Related Notes by Tag plugin loaded.")}onunload(){console.log("Unloading Related Notes by Tag plugin"),this.app.workspace.detachLeavesOfType(v),this.view=null}async loadSettings(){this.settings=Object.assign({},b,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.view&&await this.view.updateView()}async activateView(){let e=this.app.workspace.getLeavesOfType(v);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getRightLeaf(!1);t||(t=this.app.workspace.getRightLeaf(!0)),t?(await t.setViewState({type:v,active:!0}),this.app.workspace.revealLeaf(t)):new y.Notice("Could not open Related Notes panel: No available leaf.")}};

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
If you want to view the source, please visit the github repository of this plugin
*/

var S=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var V=(n,a)=>{for(var t in a)S(n,t,{get:a[t],enumerable:!0})},F=(n,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of L(a))!D.call(n,i)&&i!==t&&S(n,i,{get:()=>a[i],enumerable:!(e=R(a,i))||e.enumerable});return n};var M=n=>F(S({},"__esModule",{value:!0}),n);var O={};V(O,{default:()=>v});module.exports=M(O);var g=require("obsidian");var c=require("obsidian"),N={customSidebarTitle:"Related Notes",defaultSortMode:"name",excludedTags:"",defaultGroupState:"collapsed"},f=class extends c.PluginSettingTab{constructor(a,t){super(a,t),this.plugin=t}display(){let{containerEl:a}=this;a.empty(),new c.Setting(a).setName("Custom sidebar title").setDesc("Title displayed at the top of the Related Notes sidebar").addText(e=>e.setPlaceholder("Enter custom title").setValue(this.plugin.settings.customSidebarTitle).onChange(async i=>{this.plugin.settings.customSidebarTitle=i,await this.plugin.saveSettings()})),new c.Setting(a).setName("Default sort mode").setDesc("How to sort related notes by default").addDropdown(e=>e.addOption("name","Name").addOption("date","Date Edited").setValue(this.plugin.settings.defaultSortMode).onChange(async i=>{this.plugin.settings.defaultSortMode=i,await this.plugin.saveSettings()})),new c.Setting(a).setName("Excluded tags").setDesc("Comma-separated list of tags to exclude from related notes").addText(e=>e.setPlaceholder("e.g., #ignore, #draft").setValue(this.plugin.settings.excludedTags).onChange(async i=>{this.plugin.settings.excludedTags=i,await this.plugin.saveSettings()})),new c.Setting(a).setName("Default group state").setDesc("Initial expansion state of tag groups").addDropdown(e=>e.addOption("collapsed","Collapsed").addOption("expanded","Expanded").setValue(this.plugin.settings.defaultGroupState).onChange(async i=>{this.plugin.settings.defaultGroupState=i,await this.plugin.saveSettings()})),a.createEl("h3",{text:"Activation and Usage Instructions"});let t=a.createDiv("related-notes-instructions");t.createEl("p",{text:"To activate the Related Notes sidebar:"}),t.createEl("ul",{},e=>{e.createEl("li",{text:"Click the ribbon icon (tag icon)"}),e.createEl("li",{text:'Or use the command palette: "Open Related Notes Panel"'})}),t.createEl("p",{text:"Usage:"}),t.createEl("ul",{},e=>{e.createEl("li",{text:"Click tag group header to expand/collapse group"}),e.createEl("li",{text:"Click note name to open in current tab"}),e.createEl("li",{text:"cmd/ctrl click note name to open in new tab"}),e.createEl("li",{text:"Click Name/Date to change sort order"})})}};var d=require("obsidian"),p="related-notes-view",m=class extends d.ItemView{async handleSortChange(a){this.plugin.settings.defaultSortMode=a,await this.plugin.saveSettings(),this.updateView()}constructor(a,t){super(a),this.plugin=t}getViewType(){return p}getDisplayText(){return"Related Notes"}getIcon(){return"tag"}async onOpen(){this.container=this.contentEl,this.container.empty(),this.container.addClass("related-notes-container"),this.container.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes"}),this.updateView()}async onClose(){this.container.empty()}async updateView(){var y;if(!this.plugin.app.workspace.layoutReady)return;this.container.empty(),this.container.addClass("related-notes-container");let a=this.container.createDiv("related-notes-header");a.createEl("h4",{text:this.plugin.settings.customSidebarTitle||"Related Notes"});let t=a.createDiv("sort-controls");["name","date"].forEach(s=>{t.createEl("button",{text:s.charAt(0).toUpperCase()+s.slice(1),cls:`sort-button ${this.plugin.settings.defaultSortMode===s?"is-active":""}`}).addEventListener("click",()=>this.handleSortChange(s))});let e=this.app.workspace.getActiveFile();if(!e||!(e instanceof d.TFile)){this.container.createEl("p",{text:"No active note or not a markdown file."});return}else this.container.createEl("p",{text:e.basename,cls:"related-activefile-name"});let i=this.app.metadataCache.getFileCache(e);if(!i){this.container.createEl("p",{text:"Could not get file cache for the active note."});return}let E=(0,d.getAllTags)(i);if(!E||E.length===0){this.container.createEl("p",{text:"Active note has no tags."});return}let k=this.plugin.settings.excludedTags.split(",").map(s=>s.trim().toLowerCase()).filter(s=>s.length>0),C=[...new Set(E)].filter(s=>!k.includes(s.toLowerCase())),b=this.app.vault.getMarkdownFiles(),h=new Map;for(let s of b){if(s.path===e.path)continue;let u=this.app.metadataCache.getFileCache(s);if(u){let l=(0,d.getAllTags)(u);if(l){let x=[...new Set(l)];for(let o of C)x.includes(o)&&(h.has(o)||h.set(o,[]),(y=h.get(o))==null||y.push(s))}}}if(h.size===0){this.container.createEl("p",{text:"No other notes found with matching tags."});return}h.forEach((s,u)=>{let l=this.container.createDiv({cls:`related-notes-tag-group ${this.plugin.settings.defaultGroupState}`}),x=l.createEl("div",{text:`Notes with tag: ${u}`,cls:"related-notes-tag-group-header"}),o=l.createEl("ul",{cls:"related-notes-list"});o.style.display=this.plugin.settings.defaultGroupState==="collapsed"?"none":"",x.addEventListener("click",()=>{l.toggleClass("collapsed",!l.hasClass("collapsed")),l.hasClass("collapsed")?o.style.display="none":o.style.display=""}),this.plugin.settings.defaultSortMode==="date"?s.sort((r,w)=>w.stat.mtime-r.stat.mtime):s.sort((r,w)=>r.basename.localeCompare(w.basename)),s.forEach(r=>{o.createEl("li",{cls:"related-notes-list-item"}).createEl("a",{text:r.basename,href:"#",title:"ctrl/cmd click to open in new tab"}).addEventListener("click",T=>{T.preventDefault(),T.ctrlKey||T.metaKey?this.app.workspace.getLeaf("tab").openFile(r,{active:!0}):this.app.workspace.getLeaf().openFile(r,{active:!0})})})})}};var v=class extends g.Plugin{constructor(){super(...arguments);this.view=null}async onload(){console.log("Loading Related Notes by Tag plugin"),await this.loadSettings(),this.registerView(p,t=>(this.view=new m(t,this),this.view)),(0,g.addIcon)("related-notes-icon",'<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="M9 5H2v7l6.29 6.29c.94.94 2.48.94 3.42 0l3.58-3.58c.94-.94.94-2.48 0-3.42L9 5Z"/><path d="M6 9.01V9"/><path d="m15 5 6.3 6.3a2.69 2.69 0 0 1 0 3.79L17.5 19a2.69 2.69 0 0 1-3.79 0L10 15.21"/></svg>'),this.addRibbonIcon("related-notes-icon","Open Related Notes Panel",()=>{this.activateView()}),this.addCommand({id:"open-related-notes-panel",name:"Open Related Notes Panel",callback:()=>{this.activateView()}}),this.addSettingTab(new f(this.app,this)),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{this.view&&t&&this.view.leaf!==t&&t.view.getViewType()==="markdown"&&setTimeout(async()=>{this.view&&await this.view.updateView()},50)})),this.registerEvent(this.app.metadataCache.on("changed",async t=>{var e;this.view&&((e=this.app.workspace.getActiveFile())==null?void 0:e.path)===t.path&&await this.view.updateView()})),this.app.workspace.onLayoutReady(async()=>{if(this.app.workspace.getActiveFile()){let e=this.app.workspace.getLeavesOfType(p)[0];e&&(this.app.workspace.revealLeaf(e),this.view&&await this.view.updateView())}}),console.log("Related Notes by Tag plugin loaded.")}onunload(){console.log("Unloading Related Notes by Tag plugin"),this.app.workspace.detachLeavesOfType(p),this.view=null}async loadSettings(){this.settings=Object.assign({},N,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.view&&await this.view.updateView()}async activateView(){let t=this.app.workspace.getLeavesOfType(p);if(t.length>0){this.app.workspace.revealLeaf(t[0]);return}let e=this.app.workspace.getRightLeaf(!1);e||(e=this.app.workspace.getRightLeaf(!0)),e?(await e.setViewState({type:p,active:!0}),this.app.workspace.revealLeaf(e)):new g.Notice("Could not open Related Notes panel: No available leaf.")}};
